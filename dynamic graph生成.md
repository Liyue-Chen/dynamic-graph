# dynamic graph生成

## 典型的列车时刻表

```
1号地铁时刻表

车站    首班车    常态末班车发车时刻（周日-周四）    延时运营末班车发车时刻（周五-周六）    
往富锦路    往上海站    往莘庄    往富锦路    往上海站    往莘庄    往富锦路    往上海站    往莘庄    
莘庄    05:30    05:30    06:04(到达)    22:32    22:32    23:34(到达)    23:50    23:50    次00:54(到达)    
外环路    05:32    05:32    06:02    22:34    22:34    23:32    23:52    23:52    次00:52    
莲花路    05:34    05:34    06:00    22:36    22:36    23:30    23:54    23:54    次00:50    
锦江乐园    05:37    05:37    05:57    22:39    22:39    23:27    23:57    23:57    次00:47    
上海南站    05:18    04:55    05:54    22:42    22:42    23:24    次00:00    次00:00    次00:44    
漕宝路    05:20    04:57    05:51    22:45    22:45    23:21    次00:03    次00:03    次00:41    
上海体育馆    05:23    05:00    05:49    22:48    22:48    23:19    次00:06    次00:06    次00:39    
徐家汇    05:25    05:02    05:46    22:50    22:50    23:16    次00:08    次00:08    次00:36    
衡山路    05:27    05:04    05:44    22:52    22:52    23:14    次00:10    次00:10    次00:34    
常熟路    05:29    05:06    05:42    22:54    22:54    23:12    次00:12    次00:12    次00:32    
陕西南路    05:31    05:08    05:40    22:56    22:56    23:10    次00:14    次00:14    次00:30    
黄陂南路    05:34    05:11    05:38    22:58    22:58    23:08    次00:16    次00:16    次00:28    
人民广场    05:37    05:14    05:35    23:01    23:01    23:05    次00:19    次00:19    次00:25    
新闸路    05:38    05:15    05:33    23:03    23:03    23:03    次00:21    次00:21    次00:23    
汉中路    05:40    05:17    05:31    23:05    23:05    23:01    次00:23    次00:23    次00:21    
上海火车站    05:43    05:19(到达)    05:30    23:08    23:08    23:00    次00:26    次00:26    次00:20    
中山北路    05:45    --    05:57    23:10    --    22:57    次00:28    --    次00:17    
延长路    05:48    --    05:55    23:13    --    22:55    次00:31    --    次00:15    
上海马戏城    05:50    --    05:53    23:15    --    22:53    次00:33    --    次00:13    
汶水路    05:52    --    05:50    23:17    --    22:50    次00:35    --    次00:10    
彭浦新村    05:55    --    05:47    23:20    --    22:47    次00:38    --    次00:07    
共康路    05:58    --    05:45    23:23    --    22:45    次00:41    --    次00:05    
通河新村    06:00    --    05:42    23:25    --    22:42    次00:43    --    次00:02    
呼兰路    06:03    --    05:40    23:27    --    22:40    次00:45    --    次00:00    
共富新村    06:05    --    05:37    23:30    --    22:37    次00:48    --    23:57    
宝安公路    06:08    --    05:34    23:33    --    22:34    次00:51    --    23:54    
友谊西路    06:10    --    05:32    23:35    --    22:32    次00:53    --    23:52    
富锦路    06:12(到达)    --    05:30    23:37(到达)    --    22:30    次00:55(到达)    --    23:50    

周一　～　周四    
名称    时段    列车间隔    
莘庄～上海火车站    上海火车站～富锦路    
早高峰    7:00～9:00    平均2分30秒    
平峰    9:00～17:00    平均4分    平均6分    
晚高峰    17:00～19:00    平均3分    
其余时段    4分 ～?9分    
周五    
名称    时段    列车间隔    
莘庄～上海火车站    上海火车站～富锦路    
早高峰    7:00～9:00    平均2分30秒    
平峰    9:00～14:30    平均4分    平均6分    
晚高峰    14:30～17:00    平均4分    
17:00～19:00    平均3分    
其余时段    4分～9分    
周六、周日    
名称    时段    列车间隔    
莘庄～上海火车站    上海火车站～富锦路    
高峰时段    9:00～20:00    平均4分    
其余时段    6分～12分    
延时运营列车间隔（周五、周六）    
名称    时段    列车间隔    
莘庄～富锦路    
延时运营    22:30～运营结束    10分～16分    
```

列车时刻表基本分为以下几个时段 (几个规律)：

1. 每天的首班车发车时间是固定的，根据每个站点的差分时间间隔，可以得出站点间的`自由流`时间 (因为首班车时还不是早高峰，上下车相对较快，可以不考虑上落客时乘客拥挤导致的延误)
2. 末班车发车分为两个时段
   * 周日到周四，常态化末班车发车时刻
   * 周五到周六，延时运营末班车发车时刻
3. 列车运营间隔分为以下几个时段 (决定了发车间隔)
   * 周一到周四
     * 早高峰
     * 平峰
     * 晚高峰
   * 周五
     * 早高峰
     * 平峰
     * 晚高峰
   * 周六、周日
     * 高峰时段
     * 其余时段
   * 周五、周六延时运营时段

## 做法

1. 先按照首班车的差分时间得到站点间的自由流时间，构建一个静态的短时地铁可达矩阵. (理论有车时，可以到达的站点)
2. 按照发车间隔，根据车辆的发车间隔，构建出地铁站点间动态的可达矩阵. (实际站点不一定有车，此时可以到达的站点)

## 可能会影响精度的因素

1. 现在使用的时刻表是2020年8月后的，但是我们本身的地铁数据的跨度是`2016-07-01~ 2016-09-14`，可能存在当时的运营时刻表和现在不太一致的问题，譬如节假日调整等问题。
2. 

## Base Knowledge

**首班车并非都是从始发站发车的**

首班车时间与本线的行车组织、车厂位置等有关，并非首班车都是从起始站发车，线路的中间部分车站也会提前停靠列车，开始运营后投入载客服务。

## 有一些站点没有在过去的数据中出现过

```
['七莘路', '下南路', '世博会博物馆', '世博大道', '东兰路', '中科路', '北蔡', '华鹏路', '奉浦大道', '学林路', '康新公路', '望园路', '桂林公园', '江宁路', '江川路', '淞滨路', '淮海中路', '环城东路', '秀沿路', '自然博物馆', '莲溪路', '萧塘', '虹梅路', '虹漕路', '虹莘路', '西渡', '金海湖', '陈春路', '顾戴路']
```

这可能有几个原因：

* 部分站点是在2016年9月后开通的
* 

## Reference

1. 上海地铁高清线路图. http://sh.bendibao.com/ditie/linemap.shtml
2. http://sh.bendibao.com/ditie/shike_{222+linenum}.shtml